---
inclusion: always
---

# Project Structure

```
src/
├── app/                    # Next.js App Router
│   ├── api/[feature]/      # API routes (route.ts, [id]/route.ts)
│   ├── [feature]/page.tsx  # Feature pages
│   ├── layout.tsx          # Root layout with providers
│   └── globals.css         # Global styles & Tailwind
├── components/
│   ├── ui/                 # shadcn/ui primitives (NEVER edit)
│   ├── common/             # Shared reusable components
│   ├── layout/             # App shell components (Sidebar, MainPanel)
│   └── [feature]/          # Feature-specific components
├── lib/
│   ├── db/
│   │   ├── schema.ts       # Drizzle schema (source of truth)
│   │   ├── index.ts        # DB connection export
│   │   └── migrations/     # Auto-generated (NEVER edit)
│   ├── services/           # Business logic (*.service.ts)
│   ├── hooks/              # Custom React hooks (use*.ts)
│   └── utils/              # Helpers (validation.ts, recurrence.ts)
└── types/index.ts          # Shared TypeScript types
data/                       # SQLite files (gitignored)
```

## Protected Paths (NEVER modify)

- `src/components/ui/*` — shadcn/ui primitives, managed by CLI
- `src/lib/db/migrations/*` — auto-generated by Drizzle, use `bun db:generate`

## Architecture

| Layer | Location | Responsibility |
|-------|----------|----------------|
| API Routes | `app/api/[feature]/route.ts` | HTTP handlers, validate input, call services |
| Services | `lib/services/*.service.ts` | Business logic, DB operations via Drizzle |
| Schema | `lib/db/schema.ts` | Drizzle ORM table definitions |
| Hooks | `lib/hooks/use*.ts` | React Query wrappers for data fetching |
| Components | `components/[feature]/` | UI components, Server Components by default |

**Data flow:** API Route → Service → Drizzle → SQLite

## Import Rules

Always use `@/*` path alias for `src/` imports. Order imports as:
1. External packages (`react`, `next`, etc.)
2. `@/` aliased imports
3. Relative imports (avoid when possible)

## Naming Conventions

| Type | Pattern | Example |
|------|---------|---------|
| Components | `PascalCase.tsx` | `TaskItem.tsx` |
| Services | `kebab-case.service.ts` | `task.service.ts` |
| Hooks | `use*.ts` | `useTasks.ts` |
| Tests | `*.property.test.ts` | `task.service.property.test.ts` |
| API routes | `route.ts` in feature folder | `api/tasks/route.ts` |

## Component Guidelines

- Default to Server Components; add `'use client'` only for hooks, events, or browser APIs
- Use `cn()` from `@/lib/utils` for conditional Tailwind classes
- Colocate small feature components with routes; extract to `components/[feature]/` when reused
- Export feature components via barrel file (`index.ts`)

## TypeScript Rules

- Strict mode enabled, never use `any`
- Explicit return types on all functions
- Prefer Drizzle inferred types: `typeof tasks.$inferSelect`
- Use `unknown` with type guards when type is uncertain
